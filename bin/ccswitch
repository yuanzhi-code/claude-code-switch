#!/bin/bash

# ccswitch - Claude Code configuration switcher

# Get the directory where this script is located and resolve symlinks
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
LIB_DIR="$SCRIPT_DIR/../lib"

# Parse arguments
PROFILE_NAME=""
EXTRA_ARGS=()

for arg in "$@"; do
  case "$arg" in
    --help|-h)
      echo "Usage: ccswitch [profile] [options]"
      echo ""
      echo "Arguments:"
      echo "  profile    Name of profile to use (default: uses 'default' from config)"
      echo ""
      echo "Options:"
      echo "  --help, -h     Show this help message"
      echo "  --version, -V  Show version information"
      echo ""
      echo "Examples:"
      echo "  ccswitch kimi"
      echo "  ccswitch"
      exit 0
      ;;
    --version|-V)
      echo "ccswitch v1.0.0"
      exit 0
      ;;
    *)
      # If not a flag, treat as profile name or extra arg
      if [[ -z "$PROFILE_NAME" ]] && [[ ! "$arg" =~ ^- ]]; then
        PROFILE_NAME="$arg"
      else
        EXTRA_ARGS+=("$arg")
      fi
      ;;
  esac
done

# Call Node.js entry point
export CC_SWITCH_PROFILE="$PROFILE_NAME"
node "$LIB_DIR/cli.js" "${EXTRA_ARGS[@]}"
